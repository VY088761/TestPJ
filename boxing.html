<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ÈªûÂÖ©‰∏ã</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { 
      width:100vw; 
      height:100vh; 
      background:linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); 
      font-family:sans-serif; 
      color:#fff; 
      overflow:hidden;
    }
    #gameContainer { 
      position:relative; 
      width:100%; 
      height:100%; 
      background:linear-gradient(to bottom, #0f3460 0%, #1a1a2e 100%); 
      cursor:crosshair;
      user-select:none;
    }
    #ui {
      position:absolute;
      top:20px;
      left:20px;
      right:20px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      z-index:100;
    }
    .ui-left {
      display:flex;
      gap:30px;
      align-items:center;
    }
    .stats {
      background:rgba(0,0,0,0.6);
      padding:15px 25px;
      border-radius:10px;
      border-left:4px solid #e94560;
    }
    .stat-item {
      font-size:14px;
      color:#aaa;
      margin-bottom:5px;
    }
    .stat-value {
      font-size:24px;
      font-weight:bold;
      color:#e94560;
    }
    .combo-counter {
      background:rgba(0,0,0,0.6);
      padding:15px 25px;
      border-radius:10px;
      border-left:4px solid #ffd700;
      text-align:center;
      min-width:120px;
    }
    .combo-text {
      font-size:14px;
      color:#aaa;
    }
    .combo-num {
      font-size:32px;
      font-weight:bold;
      color:#ffd700;
      text-shadow:0 0 10px #ffd700;
    }
    .ui-right {
      display:flex;
      gap:15px;
    }
    button {
      background:linear-gradient(135deg, #e94560 0%, #c93550 100%);
      color:white;
      border:none;
      padding:12px 25px;
      border-radius:5px;
      cursor:pointer;
      font-weight:bold;
      transition:all 0.3s;
      font-size:14px;
    }
    button:hover {
      transform:translateY(-2px);
      box-shadow:0 5px 15px rgba(233, 69, 96, 0.4);
    }
    #dummyContainer {
      position:absolute;
      left:50%;
      top:50%;
      transform:translate(-50%, -50%);
      z-index:50;
      display:flex;
      flex-direction:column;
      align-items:center;
    }
    #dummyImage {
      width:200px;
      height:300px;
      object-fit:contain;
      margin-bottom:20px;
      filter:drop-shadow(0 10px 20px rgba(0,0,0,0.5));
    }
    #dummyEyes {
      position:absolute;
      top:80px;
      left:50%;
      transform:translateX(-50%);
      display:flex;
      gap:50px;
      z-index:51;
    }
    .dummy-eye {
      width:32px;
      height:20px;
      background:#fff;
      border-radius:50%;
      box-shadow:0 2px 5px rgba(0,0,0,0.3);
    }
    .dummy-eye.blink {
      background:#ffdbac;
    }
    #healthBarContainer {
      position:absolute;
      bottom:-80px;
      left:50%;
      transform:translateX(-50%);
      width:280px;
    }
    #healthBarLabel {
      font-size:14px;
      color:#aaa;
      margin-bottom:8px;
      text-align:center;
    }
    #healthBar {
      width:100%;
      height:25px;
      background:rgba(0,0,0,0.5);
      border-radius:15px;
      overflow:hidden;
      border:2px solid #e94560;
    }
    #healthFill {
      height:100%;
      background:linear-gradient(90deg, #e94560 0%, #ff6b5b 100%);
      width:100%;
      transition:width 0.3s ease;
      border-radius:13px;
      box-shadow:0 0 10px #e94560;
    }
    #healthText {
      position:absolute;
      right:10px;
      top:28px;
      font-size:12px;
      color:#fff;
      font-weight:bold;
    }
    .fist {
      position:absolute;
      width:100px;
      height:100px;
      z-index:60;
      pointer-events:none;
      filter:drop-shadow(0 5px 15px rgba(0,0,0,0.5));
      transition: transform 0.1s;
    }
     .fist.left {
            left: 30px;
        }

      .fist.right {
            right: 30px;
        }

      .fist-icon {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #f4a460 0%, #d2691e 100%);
            border-radius: 15px 15px 5px 5px;
            position: relative;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
            display: flex;
            align-items: flex-end;
            justify-content: center;
            padding-bottom: 5px;
        }

        /* Ë°ÄÊø∫ÊïàÊûú */
        .blood-splash {
            position: absolute;
            pointer-events: none;
        }
    .fist-img {
      width:100%;
      height:100%;
      object-fit:contain;
    }
    .damage-number {
      position:absolute;
      font-size:36px;
      font-weight:bold;
      color:#e94560;
      pointer-events:none;
      text-shadow:0 0 8px rgba(0,0,0,0.8);
      animation:damageFloat 1s ease-out forwards;
      z-index:80;
    }
    @keyframes damageFloat {
      0% {
        opacity:1;
        transform:translateY(0) scale(1);
      }
      100% {
        opacity:0;
        transform:translateY(-60px) scale(0.5);
      }
    }
    .blood-drop {
      position:absolute;
      border-radius:50%;
      background:#c41e3a;
      filter:blur(0.5px);
      box-shadow:0 0 5px rgba(196, 30, 58, 0.6);
      pointer-events:none;
    }
    #victoryScreen {
      position:absolute;
      top:0;
      left:0;
      width:100%;
      height:100%;
      background:rgba(0,0,0,0.95);
      display:none;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      z-index:200;
    }
    #victoryScreen.show {
      display:flex;
    }
    .victory-content {
      text-align:center;
      animation:victoryPop 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }
    @keyframes victoryPop {
      0% {
        transform:scale(0);
        opacity:0;
      }
      100% {
        transform:scale(1);
        opacity:1;
      }
    }
    .victory-title {
      font-size:72px;
      font-weight:bold;
      color:#ffd700;
      text-shadow:0 0 20px #ffd700;
      margin-bottom:20px;
      animation:pulse 0.8s infinite;
    }
    @keyframes pulse {
      0%, 100% { transform:scale(1); }
      50% { transform:scale(1.1); }
    }
    .victory-stats {
      font-size:24px;
      color:#aaa;
      margin:20px 0;
    }
    .victory-stat {
      margin:10px 0;
      color:#fff;
    }
    .victory-button {
      margin-top:30px;
      padding:15px 50px;
      font-size:18px;
    }
    #photoInput {
      display:none;
    }
    /* ÊåâÈçµÊèêÁ§∫ */
    .key-hint {
      position:absolute;
      bottom:20px;
      left:20px;
      background:rgba(0,0,0,0.6);
      padding:15px 20px;
      border-radius:10px;
      font-size:14px;
      color:#aaa;
      border-left:4px solid #00ff00;
    }
  </style>
</head>
<body>
  <div id="gameContainer">
    <div id="ui">
      <div class="ui-left">
        <div class="stats">
          <div class="stat-item">Á∏ΩÂÇ∑ÂÆ≥</div>
          <div class="stat-value" id="totalDamage">0</div>
        </div>
        <div class="combo-counter">
          <div class="combo-text">COMBO</div>
          <div class="combo-num" id="comboCount">0</div>
        </div>
      </div>
      <div class="ui-right">
        <button onclick="document.getElementById('photoInput').click()">üì∏ Êõ¥ÊèõÂÅá‰∫∫</button>
        <button onclick="resetGame()">üîÑ ÈáçÊñ∞ÈñãÂßã</button>
      </div>
      <input type="file" id="photoInput" accept="image/*">
    </div>

    <div id="dummyContainer">
            <div id="dummyHead">
                <img id="headImage" src="" alt="È†≠ÈÉ®ÁÖßÁâá">
                <div class="eyes">
                    <div class="eye" id="eye1">
                        <div class="pupil"></div>
                    </div>
                    <div class="eye" id="eye2">
                        <div class="pupil"></div>
                    </div>
                </div>
              <div class="nose">
                <div class="nose-circle"></div>
                <div class="nose-circle"></div>
              </div>
            </div>
            <div id="dummyBody"></div>
            <div id="healthBarContainer">
                <div id="healthBarLabel">HP</div>
                <div id="healthBar">
                    <div id="healthFill"></div>
                </div>
                <div id="healthText">100/100</div>
            </div>
        </div>

        <!-- Êã≥È†≠ -->
        <div class="fist left" id="leftFist">
            <div class="fist-icon">üëä</div>
        </div>
        <div class="fist right" id="rightFist">
            <div class="fist-icon">üëä</div>
        </div>

    <div class="key-hint">
      üëä Â∑¶Èçµ = Â∑¶Êã≥ | Âè≥Èçµ = Âè≥Êã≥
    </div>

    <div id="victoryScreen">
      <div class="victory-content">
        <div class="victory-title">üèÜ ÂãùÂà©ÔºÅ</div>
        <div class="victory-stats">
          <div class="victory-stat">Á∏ΩÂÇ∑ÂÆ≥: <span id="finalDamage">0</span></div>
          <div class="victory-stat">ÊúÄÈ´òÈÄ£Êìä: <span id="maxCombo">0</span></div>
        </div>
        <button class="victory-button" onclick="resetGame()">ÂÜç‰æÜ‰∏ÄÂ±Ä</button>
      </div>
    </div>
  </div>

  <script>
    const gameContainer = document.getElementById('gameContainer');
    const state = {
      maxHealth: 100,
      currentHealth: 100,
      totalDamage: 0,
      combo: 0,
      maxCombo: 0,
      gameOver: false,
      lastHit: 0,
      comboTimeout: 2000,
      lastPunchType: null
    };

    const gameContainer = document.getElementById('gameContainer');
    const dummyHead = document.getElementById('dummyHead');
    const dummyBody = document.getElementById('dummyBody');
    const healthFill = document.getElementById('healthFill');
    const healthText = document.getElementById('healthText');
    const totalDamageDisplay = document.getElementById('totalDamage');
    const comboDisplay = document.getElementById('comboCount');
    const leftFist = document.getElementById('leftFist');
    const rightFist = document.getElementById('rightFist');
    const victoryScreen = document.getElementById('victoryScreen');
    const dummyImage = document.getElementById('dummyImage');
    const photoInput = document.getElementById('photoInput');
    const eye1 = document.getElementById('eye1');
    const eye2 = document.getElementById('eye2');

    let mouseX = window.innerWidth / 2;
    let mouseY = window.innerHeight / 2;

    // ËøΩËπ§ÊªëÈº†‰ΩçÁΩÆ
    document.addEventListener('mousemove', (e) => {
      mouseX = e.clientX;
      mouseY = e.clientY;
      updateFistPosition();
    });

    function updateFistPosition() {
      leftFist.style.left = (mouseX - 100) + 'px';
      leftFist.style.top = (mouseY + 50) + 'px';
      rightFist.style.left = (mouseX + 50) + 'px';
      rightFist.style.top = (mouseY + 50) + 'px';
    }

    // Áç≤ÂèñÂÅá‰∫∫Áü©ÂΩ¢‰ΩçÁΩÆ
    function getDummyRect() {
      return dummyImage.getBoundingClientRect();
    }

    // Âà§Êñ∑ÊòØÂê¶Êìä‰∏≠ÂÅá‰∫∫
    function isDummyHit(x, y) {
      const r = getDummyRect();
      return x >= r.left && x <= r.right && y >= r.top && y <= r.bottom;
    }

    // Âà§Êñ∑ÊòØÂê¶Êìä‰∏≠È†≠ÈÉ®
    function isDummyHead(x, y) {
      const r = getDummyRect();
      const headTop = r.top;
      const headBottom = r.top + (r.height * 0.3);
      return x >= r.left && x <= r.right && y >= headTop && y <= headBottom;
    }

    // ‚úÖ Á¶ÅÁî®Âè≥ÈçµËèúÂñÆÔºàÂÖ®Â±ÄÔºâ
    document.addEventListener('contextmenu', function(e) {
      e.preventDefault();
      return false;
    }, false);

    // ‚úÖ ÂÅµÊ∏¨Â∑¶ÈçµÂíåÂè≥ÈçµÁöÑ mousedown ‰∫ã‰ª∂
    gameContainer.addEventListener('mousedown', function(e) {
      if (state.gameOver) return;
      if (!isDummyHit(e.clientX, e.clientY)) return;

      // Â∑¶ÈçµÔºàbutton === 0Ôºâ
      if (e.button === 0) {
        console.log('üî¥ Â∑¶ÈçµÊîªÊìä');
        const isHead = isDummyHead(e.clientX, e.clientY);
        const damage = isHead ? 15 : 10;
        doHit(e.clientX, e.clientY, damage, 'left', isHead);
        state.lastPunchType = 'left';
      }
      // Âè≥ÈçµÔºàbutton === 2Ôºâ
      else if (e.button === 2) {
        console.log('üîµ Âè≥ÈçµÊîªÊìä');
        const isHead = isDummyHead(e.clientX, e.clientY);
        const damage = isHead ? 15 : 10;
        doHit(e.clientX, e.clientY, damage, 'right', isHead);
        state.lastPunchType = 'right';
      }
    }, false);

    // ‚úÖ ËøΩÂä† mouseup ÂÅµÊ∏¨ÔºàÈ†êÈò≤ÈÉ®ÂàÜÁÄèË¶ΩÂô®ÂèØËÉΩÊºèÊéâÂè≥ÈçµÔºâ
    gameContainer.addEventListener('mouseup', function(e) {
      if (state.gameOver) return;
      if (!isDummyHit(e.clientX, e.clientY)) return;

      // Âè™Âú® mouseup ÊôÇÂÜçÂÅµÊ∏¨‰∏ÄÊ¨°Âè≥ÈçµÔºåÈÅøÂÖçÈáçË§áÊîªÊìä
      if (e.button === 2 && state.lastPunchType !== 'right') {
        console.log('üîµ Âè≥ÈçµÊîªÊìä (mouseup ÂÇôÁî®)');
        const isHead = isDummyHead(e.clientX, e.clientY);
        const damage = isHead ? 15 : 10;
        doHit(e.clientX, e.clientY, damage, 'right', isHead);
      }
    }, false);

    function doHit(x, y, damage, punchType, isHead) {
      state.currentHealth = Math.max(0, state.currentHealth - damage);
      state.totalDamage += damage;

      const now = Date.now();
      if (now - state.lastHit > state.comboTimeout) {
        state.combo = 0;
      }
      state.combo++;
      state.maxCombo = Math.max(state.maxCombo, state.combo);
      state.lastHit = now;

      setTimeout(() => {
        if (Date.now() - state.lastHit > state.comboTimeout) {
          state.combo = 0;
          comboDisplay.textContent = '0';
        }
      }, state.comboTimeout);

      updateHealth();
      totalDamageDisplay.textContent = state.totalDamage;
      comboDisplay.textContent = state.combo;

      createDamageNumber(x, y, damage);
      createBloodSplash(x, y);

      animateFist(punchType === 'left' ? leftFist : rightFist);

      if (isHead) {
        blinkEyes();
      }

      if (navigator.vibrate) {
        navigator.vibrate(50);
      }

      if (state.currentHealth <= 0) {
        endGame();
      }
    }

    function updateHealth() {
      const percent = (state.currentHealth / state.maxHealth) * 100;
      healthFill.style.width = percent + '%';
      healthText.textContent = `${state.currentHealth}/${state.maxHealth}`;
    }

    function animateFist(fist) {
      fist.style.transform = 'scale(1.2)';
      setTimeout(() => {
        fist.style.transform = 'scale(1)';
      }, 100);
    }

    function blinkEyes() {
      eye1.classList.add('blink');
      eye2.classList.add('blink');
      setTimeout(() => {
        eye1.classList.remove('blink');
        eye2.classList.remove('blink');
      }, 300);
    }

    function createDamageNumber(x, y, damage) {
      const num = document.createElement('div');
      num.className = 'damage-number';
      num.textContent = damage;
      num.style.left = x + 'px';
      num.style.top = y + 'px';
      num.style.transform = 'translate(-50%, -50%)';
      gameContainer.appendChild(num);
      setTimeout(() => {
        num.remove();
      }, 1000);
    }

    function createBloodSplash(x, y) {
      const splashCount = 8 + Math.random() * 4;
      for (let i = 0; i < splashCount; i++) {
        const angle = (Math.PI * 2 * i) / splashCount;
        const velocity = 3 + Math.random() * 4;
        const vx = Math.cos(angle) * velocity;
        const vy = Math.sin(angle) * velocity;

        const drop = document.createElement('div');
        drop.className = 'blood-drop';
        drop.style.left = x + 'px';
        drop.style.top = y + 'px';
        drop.style.width = (4 + Math.random() * 6) + 'px';
        drop.style.height = drop.style.width;

        gameContainer.appendChild(drop);

        let dropX = x;
        let dropY = y;
        let dropVx = vx;
        let dropVy = vy + 1;

        const animate = () => {
          dropX += dropVx;
          dropY += dropVy;
          dropVy += 0.3;

          drop.style.left = dropX + 'px';
          drop.style.top = dropY + 'px';

          if (dropY < window.innerHeight) {
            requestAnimationFrame(animate);
          } else {
            drop.remove();
          }
        };

        animate();
      }
    }

    function endGame() {
      state.gameOver = true;
      document.getElementById('finalDamage').textContent = state.totalDamage;
      document.getElementById('maxCombo').textContent = state.maxCombo;
      victoryScreen.classList.add('show');
    }

    function resetGame() {
      state.currentHealth = state.maxHealth;
      state.totalDamage = 0;
      state.combo = 0;
      state.maxCombo = 0;
      state.gameOver = false;
      state.lastHit = 0;
      state.lastPunchType = null;

      updateHealth();
      totalDamageDisplay.textContent = '0';
      comboDisplay.textContent = '0';
      victoryScreen.classList.remove('show');
    }

    // ÁÖßÁâá‰∏äÂÇ≥
    photoInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (event) => {
          dummyImage.src = event.target.result;
        };
        reader.readAsDataURL(file);
      }
    });

    // ÂàùÂßãÂåñ
    updateHealth();
    updateFistPosition();
  </script>
</body>
</html>
