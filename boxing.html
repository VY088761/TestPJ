<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Êã≥ÊìäË®ìÁ∑¥ÈÅäÊà≤</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            width: 100%;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            font-family: 'Arial', sans-serif;
            color: #fff;
            overflow: hidden;
        }

        #gameContainer {
            position: relative;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, #0f3460 0%, #1a1a2e 100%);
            cursor: crosshair;
        }

        /* ‰∏äÊñπUI */
        #ui {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
        }

        .ui-left {
            display: flex;
            gap: 30px;
            align-items: center;
        }

        .stats {
            background: rgba(0, 0, 0, 0.6);
            padding: 15px 25px;
            border-radius: 10px;
            border-left: 4px solid #e94560;
        }

        .stat-item {
            font-size: 14px;
            color: #aaa;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #e94560;
        }

        .combo-counter {
            background: rgba(0, 0, 0, 0.6);
            padding: 15px 25px;
            border-radius: 10px;
            border-left: 4px solid #ffd700;
            text-align: center;
            min-width: 120px;
        }

        .combo-text {
            font-size: 14px;
            color: #aaa;
        }

        .combo-num {
            font-size: 32px;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 0 0 10px #ffd700;
        }

        .ui-right {
            display: flex;
            gap: 15px;
        }

        button {
            background: linear-gradient(135deg, #e94560 0%, #c93550 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            font-size: 14px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(233, 69, 96, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        /* ÂÅá‰∫∫ */
        #dummyContainer {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            z-index: 50;
        }

        #dummyHead {
            width: 180px;
            height: 180px;
            background: radial-gradient(circle at 35% 35%, #ffdbac, #d4a574);
            border-radius: 50%;
            position: relative;
            margin: 0 auto 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            overflow: hidden;
        }

        #dummyHead img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
            display: none;
        }

        #dummyHead.has-image img {
            display: block;
        }

        #dummyHead.has-image::before {
            display: none;
        }

        /* ÁúºÁùõ */
        .eyes {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            gap: 40px;
        }

        .eye {
            width: 30px;
            height: 40px;
            background: white;
            border-radius: 50%;
            position: relative;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        .pupil {
            width: 15px;
            height: 20px;
            background: #333;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.1s;
        }

        .eye.blink::before,
        .eye.blink::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 50%;
            background: #ffdbac;
            left: 0;
            animation: blink 0.3s ease-in-out;
        }

        .eye.blink::before {
            top: 0;
        }

        .eye.blink::after {
            bottom: 0;
        }

        @keyframes blink {
            0%, 100% { height: 0; }
            50% { height: 50%; }
        }

        #dummyBody {
            width: 150px;
            height: 220px;
            background: linear-gradient(135deg, #ff6b5b 0%, #e84c3d 100%);
            border-radius: 20px;
            margin: 0 auto;
            position: relative;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5), inset 0 0 20px rgba(255, 255, 255, 0.1);
        }

        /* ÂÅ•Â∫∑Ê¢ù */
        #healthBarContainer {
            position: absolute;
            bottom: -60px;
            left: 50%;
            transform: translateX(-50%);
            width: 250px;
        }

        #healthBarLabel {
            font-size: 14px;
            color: #aaa;
            margin-bottom: 8px;
            text-align: center;
        }

        #healthBar {
            width: 100%;
            height: 25px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            overflow: hidden;
            border: 2px solid #e94560;
        }

        #healthFill {
            height: 100%;
            background: linear-gradient(90deg, #e94560 0%, #ff6b5b 100%);
            width: 100%;
            transition: width 0.3s ease;
            border-radius: 13px;
            box-shadow: 0 0 10px #e94560;
        }

        #healthText {
            position: absolute;
            right: 10px;
            top: 28px;
            font-size: 12px;
            color: #fff;
            font-weight: bold;
        }

        /* Êã≥È†≠ */
        .fist {
            position: absolute;
            width: 60px;
            height: 80px;
            z-index: 60;
        }

        .fist.left {
            left: 30px;
        }

        .fist.right {
            right: 30px;
        }

        .fist-icon {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #f4a460 0%, #d2691e 100%);
            border-radius: 15px 15px 5px 5px;
            position: relative;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
            display: flex;
            align-items: flex-end;
            justify-content: center;
            padding-bottom: 5px;
        }

        /* Ë°ÄÊø∫ÊïàÊûú */
        .blood-splash {
            position: absolute;
            pointer-events: none;
        }

        .blood-drop {
            position: absolute;
            border-radius: 50%;
            background: #c41e3a;
            filter: blur(0.5px);
            box-shadow: 0 0 5px rgba(196, 30, 58, 0.6);
        }

        /* ÂÇ∑ÂÆ≥Êï∏Â≠ó */
        .damage-number {
            position: absolute;
            font-size: 32px;
            font-weight: bold;
            color: #e94560;
            pointer-events: none;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.8);
            animation: damageFloat 1s ease-out forwards;
        }

        @keyframes damageFloat {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-60px) scale(0.5);
            }
        }

        /* ÂãùÂà©Áï´Èù¢ */
        #victoryScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 200;
        }

        #victoryScreen.show {
            display: flex;
        }

        .victory-content {
            text-align: center;
            animation: victoryPop 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes victoryPop {
            0% {
                transform: scale(0);
                opacity: 0;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .victory-title {
            font-size: 72px;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 0 0 20px #ffd700;
            margin-bottom: 20px;
            animation: pulse 0.8s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .victory-stats {
            font-size: 24px;
            color: #aaa;
            margin: 20px 0;
        }

        .victory-stat {
            margin: 10px 0;
            color: #fff;
        }

        .victory-button {
            margin-top: 30px;
            padding: 15px 50px;
            font-size: 18px;
        }

        /* ‰∏äÂÇ≥ÊåâÈàïÂÆπÂô® */
        #uploadContainer {
            position: relative;
            display: inline-block;
        }

        #photoInput {
            display: none;
        }

        /* ÈüøÊáâÂºè */
        @media (max-width: 768px) {
            #ui {
                top: 10px;
                left: 10px;
                right: 10px;
            }

            .ui-left {
                flex-direction: column;
                gap: 15px;
            }

            .stats {
                padding: 10px 15px;
            }

            .stat-value {
                font-size: 18px;
            }

            #dummyHead {
                width: 120px;
                height: 120px;
            }

            #dummyBody {
                width: 100px;
                height: 150px;
            }

            .victory-title {
                font-size: 48px;
            }

            .victory-stats {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <!-- UIÈ°∂ÈÉ® -->
        <div id="ui">
            <div class="ui-left">
                <div class="stats">
                    <div class="stat-item">Á∏ΩÂÇ∑ÂÆ≥</div>
                    <div class="stat-value" id="totalDamage">0</div>
                </div>
                <div class="combo-counter">
                    <div class="combo-text">COMBO</div>
                    <div class="combo-num" id="comboCount">0</div>
                </div>
            </div>
            <div class="ui-right">
                <div id="uploadContainer">
                    <button onclick="document.getElementById('photoInput').click()">üì∏ ‰∏äÂÇ≥ÁÖßÁâá</button>
                    <input type="file" id="photoInput" accept="image/*">
                </div>
                <button onclick="resetGame()">üîÑ ÈáçÊñ∞ÈñãÂßã</button>
            </div>
        </div>

        <!-- ÂÅá‰∫∫ÂÆπÂô® -->
        <div id="dummyContainer">
            <div id="dummyHead">
                <img id="headImage" src="" alt="È†≠ÈÉ®ÁÖßÁâá">
                <div class="eyes">
                    <div class="eye" id="eye1">
                        <div class="pupil"></div>
                    </div>
                    <div class="eye" id="eye2">
                        <div class="pupil"></div>
                    </div>
                </div>
            </div>
            <div id="dummyBody"></div>
            <div id="healthBarContainer">
                <div id="healthBarLabel">HP</div>
                <div id="healthBar">
                    <div id="healthFill"></div>
                </div>
                <div id="healthText">100/100</div>
            </div>
        </div>

        <!-- Êã≥È†≠ -->
        <div class="fist left" id="leftFist">
            <div class="fist-icon">üëä</div>
        </div>
        <div class="fist right" id="rightFist">
            <div class="fist-icon">üëä</div>
        </div>

        <!-- ÂãùÂà©Áï´Èù¢ -->
        <div id="victoryScreen">
            <div class="victory-content">
                <div class="victory-title">üèÜ ÂãùÂà©ÔºÅ</div>
                <div class="victory-stats">
                    <div class="victory-stat">Á∏ΩÂÇ∑ÂÆ≥: <span id="finalDamage">0</span></div>
                    <div class="victory-stat">ÊúÄÈ´òÈÄ£Êìä: <span id="maxCombo">0</span></div>
                </div>
                <button class="victory-button" onclick="resetGame()">ÂÜç‰æÜ‰∏ÄÂ±Ä</button>
            </div>
        </div>
    </div>

    <script>
        // ÈÅäÊà≤ÁãÄÊÖã
        const gameState = {
            maxHealth: 100,
            currentHealth: 100,
            totalDamage: 0,
            combo: 0,
            maxCombo: 0,
            gameOver: false,
            lastHitTime: 0,
            comboTimeout: 2000
        };

        const gameContainer = document.getElementById('gameContainer');
        const dummyHead = document.getElementById('dummyHead');
        const dummyBody = document.getElementById('dummyBody');
        const healthFill = document.getElementById('healthFill');
        const healthText = document.getElementById('healthText');
        const totalDamageDisplay = document.getElementById('totalDamage');
        const comboDisplay = document.getElementById('comboCount');
        const leftFist = document.getElementById('leftFist');
        const rightFist = document.getElementById('rightFist');
        const victoryScreen = document.getElementById('victoryScreen');
        const photoInput = document.getElementById('photoInput');
        const headImage = document.getElementById('headImage');
        const eye1 = document.getElementById('eye1');
        const eye2 = document.getElementById('eye2');

        let mouseX = window.innerWidth / 2;
        let mouseY = window.innerHeight / 2;

        // ËøΩËπ§ÊªëÈº†‰ΩçÁΩÆ
        document.addEventListener('mousemove', (e) => {
            mouseX = e.clientX;
            mouseY = e.clientY;
            updateFistPosition();
        });

        // Ëß∏Êë∏ÊîØÊåÅ
        document.addEventListener('touchmove', (e) => {
            const touch = e.touches[0];
            mouseX = touch.clientX;
            mouseY = touch.clientY;
            updateFistPosition();
        });

        function updateFistPosition() {
            const leftOffsetX = -150;
            const leftOffsetY = -40;
            const rightOffsetX = 150;
            const rightOffsetY = -40;

            leftFist.style.left = (mouseX + leftOffsetX) + 'px';
            leftFist.style.top = (mouseY + leftOffsetY) + 'px';
            rightFist.style.left = (mouseX + rightOffsetX) + 'px';
            rightFist.style.top = (mouseY + rightOffsetY) + 'px';
        }

        // ÈÅäÊà≤ÂÆπÂô®ÈªûÊìä‰∫ã‰ª∂
        gameContainer.addEventListener('click', (e) => {
            if (gameState.gameOver) return;

            const dummyHeadRect = dummyHead.getBoundingClientRect();
            const dummyBodyRect = dummyBody.getBoundingClientRect();

            const isHeadHit = 
                e.clientX >= dummyHeadRect.left &&
                e.clientX <= dummyHeadRect.right &&
                e.clientY >= dummyHeadRect.top &&
                e.clientY <= dummyHeadRect.bottom;

            const isBodyHit = 
                e.clientX >= dummyBodyRect.left &&
                e.clientX <= dummyBodyRect.right &&
                e.clientY >= dummyBodyRect.top &&
                e.clientY <= dummyBodyRect.bottom;

            if (isHeadHit || isBodyHit) {
                const damage = isHeadHit ? 15 : 10;
                hitDummy(e.clientX, e.clientY, damage, isHeadHit);
            }
        });

        // Ëß∏Êë∏ÈªûÊìäÊîØÊåÅ
        gameContainer.addEventListener('touchstart', (e) => {
            if (gameState.gameOver) return;

            const touch = e.touches[0];
            const dummyHeadRect = dummyHead.getBoundingClientRect();
            const dummyBodyRect = dummyBody.getBoundingClientRect();

            const isHeadHit = 
                touch.clientX >= dummyHeadRect.left &&
                touch.clientX <= dummyHeadRect.right &&
                touch.clientY >= dummyHeadRect.top &&
                touch.clientY <= dummyHeadRect.bottom;

            const isBodyHit = 
                touch.clientX >= dummyBodyRect.left &&
                touch.clientX <= dummyBodyRect.right &&
                touch.clientY >= dummyBodyRect.top &&
                touch.clientY <= dummyBodyRect.bottom;

            if (isHeadHit || isBodyHit) {
                const damage = isHeadHit ? 15 : 10;
                hitDummy(touch.clientX, touch.clientY, damage, isHeadHit);
            }
        });

        function hitDummy(x, y, damage, isHead) {
            // Ë®àÁÆóÂÇ∑ÂÆ≥
            gameState.currentHealth = Math.max(0, gameState.currentHealth - damage);
            gameState.totalDamage += damage;

            // ÈÄ£ÊìäÁ≥ªÁµ±
            const now = Date.now();
            if (now - gameState.lastHitTime > gameState.comboTimeout) {
                gameState.combo = 0;
            }
            gameState.combo++;
            gameState.maxCombo = Math.max(gameState.maxCombo, gameState.combo);
            gameState.lastHitTime = now;

            // ÈáçÁΩÆÈÄ£ÊìäÈ°ØÁ§∫
            setTimeout(() => {
                if (Date.now() - gameState.lastHitTime > gameState.comboTimeout) {
                    gameState.combo = 0;
                    comboDisplay.textContent = '0';
                }
            }, gameState.comboTimeout);

            // Êõ¥Êñ∞UI
            updateHealth();
            totalDamageDisplay.textContent = gameState.totalDamage;
            comboDisplay.textContent = gameState.combo;

            // Ë¶ñË¶∫ÂèçÈ•ã
            createDamageNumber(x, y, damage);
            createBloodSplash(x, y);

            if (isHead) {
                blinkEyes();
                shakeElement(dummyHead, 30, 150);
            } else {
                shakeElement(dummyBody, 30, 150);
            }

            // ÈúáÂãïÂèçÈ•ã
            if (navigator.vibrate) {
                navigator.vibrate(50);
            }

            // ÊîªÊìäÂãïÁï´
            animateFist(x, y);

            // Ê™¢Êü•ÈÅäÊà≤ÁµêÊùü
            if (gameState.currentHealth <= 0) {
                endGame();
            }
        }

        function animateFist(x, y) {
            // Ê±∫ÂÆö‰ΩøÁî®Âì™ÂÄãÊã≥È†≠
            const dummyRect = dummyHead.getBoundingClientRect();
            const isLeft = x < dummyRect.left + dummyRect.width / 2;
            const fist = isLeft ? leftFist : rightFist;

            fist.style.transform = 'scale(1.2)';
            setTimeout(() => {
                fist.style.transform = 'scale(1)';
            }, 100);
        }

        function blinkEyes() {
            eye1.classList.add('blink');
            eye2.classList.add('blink');

            setTimeout(() => {
                eye1.classList.remove('blink');
                eye2.classList.remove('blink');
            }, 300);
        }

        function shakeElement(element, intensity, duration) {
            const originalLeft = element.style.left;
            const originalTop = element.style.top;
            const startTime = Date.now();

            function shake() {
                const elapsed = Date.now() - startTime;
                const progress = elapsed / duration;

                if (progress < 1) {
                    const x = (Math.random() - 0.5) * intensity * (1 - progress);
                    const y = (Math.random() - 0.5) * intensity * (1 - progress);

                    element.style.transform = `translate(${x}px, ${y}px)`;
                    requestAnimationFrame(shake);
                } else {
                    element.style.transform = 'translate(0, 0)';
                }
            }

            shake();
        }

        function createDamageNumber(x, y, damage) {
            const number = document.createElement('div');
            number.className = 'damage-number';
            number.textContent = damage;
            number.style.left = x + 'px';
            number.style.top = y + 'px';
            number.style.transform = 'translate(-50%, -50%)';

            gameContainer.appendChild(number);

            setTimeout(() => {
                number.remove();
            }, 1000);
        }

        function createBloodSplash(x, y) {
            const splashCount = 8 + Math.random() * 4;
            for (let i = 0; i < splashCount; i++) {
                const angle = (Math.PI * 2 * i) / splashCount;
                const velocity = 3 + Math.random() * 4;
                const vx = Math.cos(angle) * velocity;
                const vy = Math.sin(angle) * velocity;

                const drop = document.createElement('div');
                drop.className = 'blood-drop';
                drop.style.left = x + 'px';
                drop.style.top = y + 'px';
                drop.style.width = (4 + Math.random() * 6) + 'px';
                drop.style.height = drop.style.width;

                gameContainer.appendChild(drop);

                let dropX = x;
                let dropY = y;
                let dropVx = vx;
                let dropVy = vy + 1; // ÈáçÂäõ

                const animate = () => {
                    dropX += dropVx;
                    dropY += dropVy;
                    dropVy += 0.3; // ÈáçÂäõÂä†ÈÄüÂ∫¶

                    drop.style.left = dropX + 'px';
                    drop.style.top = dropY + 'px';

                    if (dropY < window.innerHeight) {
                        requestAnimationFrame(animate);
                    } else {
                        drop.remove();
                    }
                };

                animate();
            }
        }

        function updateHealth() {
            const healthPercent = (gameState.currentHealth / gameState.maxHealth) * 100;
            healthFill.style.width = healthPercent + '%';
            healthText.textContent = `${gameState.currentHealth}/${gameState.maxHealth}`;
        }

        function endGame() {
            gameState.gameOver = true;
            document.getElementById('finalDamage').textContent = gameState.totalDamage;
            document.getElementById('maxCombo').textContent = gameState.maxCombo;
            victoryScreen.classList.add('show');
        }

        function resetGame() {
            gameState.currentHealth = gameState.maxHealth;
            gameState.totalDamage = 0;
            gameState.combo = 0;
            gameState.maxCombo = 0;
            gameState.gameOver = false;
            gameState.lastHitTime = 0;

            updateHealth();
            totalDamageDisplay.textContent = '0';
            comboDisplay.textContent = '0';
            victoryScreen.classList.remove('show');
        }

        // ÁÖßÁâá‰∏äÂÇ≥
        photoInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    headImage.src = event.target.result;
                    dummyHead.classList.add('has-image');
                };
                reader.readAsDataURL(file);
            }
        });

        // ÂàùÂßãÂåñ
        updateHealth();
        updateFistPosition();
    </script>
</body>
</html>
