<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>é»æ“Šç¦®ç‰©ç›’ - è·³å‡ºé¬¼è‡‰</title>
  <style>
    :root{
      --bg:#0b0720;
      --box:#ff4d67;
      --ribbon:#fff2f3;
      --shadow: rgba(0,0,0,0.45);
      --accent: #ffd166;
    }
    html,body{height:100%;margin:0;font-family:system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans TC";background:
      radial-gradient(1200px 600px at 10% 10%, rgba(255,255,255,0.02), transparent),
      linear-gradient(180deg,#050312 0%, #0b0720 60%); color:#fff;display:flex;align-items:center;justify-content:center;}
    .wrap{display:flex;flex-direction:column;align-items:center;gap:18px}
    .hint{font-size:18px;opacity:0.95}

    .box-scene{width:260px;height:260px;position:relative;display:flex;align-items:flex-end;justify-content:center;cursor:pointer;user-select:none}

    /* ç¦®ç‰©ç›’æœ¬é«”ï¼ˆå§‹çµ‚è“‹è‘—ï¼Œä¸åšé–‹è“‹å‹•ç•«ï¼‰ */
    .gift{
      width:160px;height:120px;background:linear-gradient(180deg,var(--box), #b32a45);
      border-radius:8px;position:relative;box-shadow:0 14px 30px var(--shadow), inset 0 -6px 12px rgba(0,0,0,0.15);
      transform-origin:center bottom;
    }
    /* è“‹å­ï¼ˆéœæ­¢çš„è“‹è‘—æ¨£å¼ï¼‰ */
    .lid{
      position:absolute;top:-26px;width:180px;height:36px;background:linear-gradient(180deg,#ff6d80,#b02a40);
      border-radius:8px;left:50%;transform:translateX(-50%);box-shadow:0 8px 18px rgba(0,0,0,0.4);
      transform-origin:center bottom;
    }
    /* è´è¶çµ (ç°¡å–®é€ å‹) */
    .bow{
      position:absolute;top:-8px;left:50%;transform:translateX(-50%);width:84px;height:48px;
      display:flex;align-items:center;justify-content:center;gap:6px;
    }
    .bow .knot{width:18px;height:18px;background:var(--ribbon);border-radius:4px;box-shadow:inset 0 -3px rgba(0,0,0,0.08)}
    .bow .loop{width:30px;height:18px;background:linear-gradient(180deg,#fff,#ffd6db);border-radius:8px;transform:rotate(10deg)}
    .bow .loop.right{transform:rotate(-10deg)}
    /* ç¶å¸¶ */
    .ribbon-vert{position:absolute;left:50%;top:0;bottom:0;width:18px;background:linear-gradient(180deg,#ffdfe6,#ffb6c7);transform:translateX(-50%);border-radius:6px}
    .ribbon-horiz{position:absolute;top:36px;left:6px;right:6px;height:18px;background:linear-gradient(90deg,#ffdfe6,#ffb6c7);border-radius:6px}

    /* CTAï¼šå¤§ã€é–ƒçˆçš„ã€Œè«‹é»æˆ‘ã€ */
    .cta {
      position:absolute;
      top:14px;
      left:50%;
      transform:translateX(-50%);
      font-weight:900;
      font-size:34px;
      letter-spacing:2px;
      color:var(--accent);
      text-shadow:
        0 0 6px rgba(255,209,102,0.9),
        0 6px 18px rgba(0,0,0,0.6);
      pointer-events:none;
      user-select:none;
      animation: glow 1200ms ease-in-out infinite, flicker 2000ms infinite;
    }
    @keyframes glow {
      0% { text-shadow: 0 0 2px rgba(255,209,102,0.6), 0 4px 12px rgba(0,0,0,0.5); transform: translateX(-50%) translateY(0) scale(1); opacity:0.95; }
      50% { text-shadow: 0 0 16px rgba(255,209,102,1), 0 10px 28px rgba(0,0,0,0.6); transform: translateX(-50%) translateY(-4px) scale(1.02); opacity:1; }
      100% { text-shadow: 0 0 2px rgba(255,209,102,0.6), 0 4px 12px rgba(0,0,0,0.5); transform: translateX(-50%) translateY(0) scale(1); opacity:0.95; }
    }
    /* äº‚åºå¾®é–ƒæ•ˆæœè®“æ–‡å­—åƒåœ¨é–ƒçˆ */
    @keyframes flicker {
      0% { opacity:1; filter:brightness(1.0); }
      7% { opacity:0.85; filter:brightness(1.3); }
      14% { opacity:0.98; filter:brightness(0.9); }
      21% { opacity:0.92; filter:brightness(1.2); }
      28% { opacity:0.99; filter:brightness(1.0); }
      100% { opacity:1; filter:brightness(1.0); }
    }

    /* å°ç«èŠ±ï¼confetti */
    .confetti { position:absolute; inset:0; pointer-events:none; overflow:visible; }
    .confetti .p { position:absolute; width:8px; height:12px; border-radius:2px; transform-origin:center; opacity:0; animation:burst 900ms forwards ease-out; }
    @keyframes burst {
      0% { opacity:1; transform:translateY(0) scale(1) rotate(0deg); }
      100% { opacity:0; transform:translateY(-160px) translateX(var(--tx)) rotate(var(--rot)) scale(0.6); }
    }

    /* æ¨¡æ…‹è¦†è“‹ (å‚™æ´) */
    .overlay { position:fixed; inset:0; display:flex;align-items:center;justify-content:center;background:rgba(3,2,10,0.65);backdrop-filter:blur(2px); visibility:hidden; opacity:0; transition:opacity .18s; z-index:40 }
    .overlay.show { visibility:visible; opacity:1; }
    .modal { width:min(520px,92vw); max-width:760px; background:linear-gradient(180deg,#0b0716,#120922); border-radius:12px; padding:28px; box-shadow:0 20px 60px rgba(3,2,10,0.7); color:#fff; display:flex;flex-direction:column;align-items:center; gap:14px; }
    .close-btn{background:#ff6b6b;color:#fff;border:0;padding:8px 12px;border-radius:8px;cursor:pointer}
    .small{font-size:13px;opacity:0.9}

    @media (max-width:420px){
      .gift{width:140px;height:100px}
      .lid{width:160px;height:32px}
      .cta { font-size:24px; top:8px; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="hint">é»æ“Šç¦®ç‰©ç›’çœ‹çœ‹æœ‰ä»€éº¼é©šå–œï¼</div>

    <div id="scene" class="box-scene" aria-hidden="false" title="é»æ“Šæˆ‘">
      <div class="confetti" id="confetti"></div>

      <div id="lid" class="lid" aria-hidden="true">
        <div class="bow" aria-hidden="true">
          <div class="loop"></div>
          <div class="knot"></div>
          <div class="loop right"></div>
        </div>
      </div>

      <div id="gift" class="gift" role="button" tabindex="0" aria-label="ç¦®ç‰©ç›’"></div>

      <div class="ribbon-vert" aria-hidden="true"></div>
      <div class="ribbon-horiz" aria-hidden="true"></div>

      <!-- å¤§ä¸”é–ƒçˆçš„è«‹é»æˆ‘ -->
      <div class="cta" aria-hidden="true">è«‹é»æˆ‘</div>
    </div>

    <div class="small">ï¼ˆæˆ–æŒ‰éµç›¤ç©ºç™½éµ / Enterï¼‰</div>
  </div>

  <!-- æ¨¡æ…‹å‚™æ´ -->
  <div id="overlay" class="overlay" role="dialog" aria-modal="true">
    <div class="modal" id="modalContent">
      <div id="ghostContainer" style="width:320px;height:320px;display:flex;align-items:center;justify-content:center"></div>
      <button class="close-btn" id="closeModal">é—œé–‰</button>
    </div>
  </div>

  <script>
    const scene = document.getElementById('scene');
    const gift = document.getElementById('gift');
    const lid = document.getElementById('lid');
    const confettiRoot = document.getElementById('confetti');

    // ç”¢ç”Ÿ confetti å…ƒç´ 
    function spawnConfetti(xOrigin = 80, count = 18) {
      const colors = ['#ffd166','#ef476f','#06d6a0','#118ab2','#f72585'];
      for (let i = 0; i < count; i++) {
        const p = document.createElement('div');
        p.className = 'p';
        p.style.background = colors[Math.floor(Math.random()*colors.length)];
        const tx = (Math.random()*260 - 130) + 'px';
        p.style.setProperty('--tx', tx);
        p.style.setProperty('--rot', (Math.random()*720 - 360) + 'deg');
        p.style.left = (80 + (Math.random()*40-20)) + 'px';
        p.style.top = (60 + Math.random()*30) + 'px';
        p.style.transform = `translateZ(0)`;
        confettiRoot.appendChild(p);
        // ç§»é™¤
        setTimeout(()=> p.remove(), 1200 + Math.random()*600);
      }
    }

    // WebAudio ç°¡å–®æ‰“æ“ŠéŸ³ï¼ˆç”¨æ–¼ç¦®ç‰©æ‰“é–‹ï¼‰
    function playPopAudio() {
      try {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const o = ctx.createOscillator();
        const g = ctx.createGain();
        o.type = 'triangle';
        o.frequency.setValueAtTime(420, ctx.currentTime);
        o.connect(g);
        g.connect(ctx.destination);
        g.gain.setValueAtTime(0, ctx.currentTime);
        g.gain.linearRampToValueAtTime(0.14, ctx.currentTime + 0.01);
        o.start();
        g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.45);
        o.frequency.exponentialRampToValueAtTime(160, ctx.currentTime + 0.45);
        setTimeout(()=>{ o.stop(); ctx.close(); }, 600);
      } catch(e){ /* ignore */ }
    }

    // ç”Ÿæˆé¬¼è‡‰é é¢å…§å®¹å­—ä¸² (å¯å¯«å…¥æ–°è¦–çª—)
    function ghostHtml() {
      return `<!doctype html>
      <html lang="zh-Hant">
      <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width,initial-scale=1">
        <title>é¬¼è‡‰é©šå–œ</title>
        <style>
          html,body{height:100%;margin:0;background:radial-gradient(circle at 20% 10%, #ffffff10, transparent), linear-gradient(180deg,#08010b,#0d0212);display:flex;align-items:center;justify-content:center;font-family:system-ui, -apple-system, "Noto Sans TC";color:#fff}
          .stage{display:flex;flex-direction:column;align-items:center;gap:20px}
          .ghost-wrap{width:320px;height:320px;display:flex;align-items:center;justify-content:center;filter:drop-shadow(0 12px 28px rgba(0,0,0,0.6))}
          svg{width:90%;height:90%;transform:scale(0.6);animation:pop 420ms cubic-bezier(.2,.9,.2,1) forwards}
          @keyframes pop { from{transform:scale(0.1);opacity:0} to{transform:scale(1);opacity:1} }
          .msg{font-size:20px;opacity:0.95}
          .btn{background:#ffd6e0;color:#2b0611;padding:10px 14px;border-radius:9px;border:0;font-weight:700;cursor:pointer}
        </style>
      </head>
      <body>
        <div class="stage">
          <div class="ghost-wrap" aria-hidden="false">
            <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="é¬¼è‡‰">
              <defs>
                <radialGradient id="g" cx="40%" cy="30%">
                  <stop offset="0%" stop-color="#ffffff"/>
                  <stop offset="100%" stop-color="#e8f7ff"/>
                </radialGradient>
              </defs>
              <g>
                <path d="M30 70 Q30 30 70 24 Q100 18 130 24 Q170 30 170 70 Q170 110 160 126 Q150 142 140 140 Q130 138 120 146 Q110 154 100 146 Q90 138 80 142 Q70 146 60 142 Q50 138 40 126 Q30 110 30 70 Z"
                  fill="url(#g)" stroke="#ffffff33" stroke-width="1.2" />
                <ellipse cx="80" cy="82" rx="8" ry="12" fill="#0a0a0a" />
                <ellipse cx="120" cy="82" rx="8" ry="12" fill="#0a0a0a" />
                <path d="M78 118 Q100 136 122 118" stroke="#0a0a0a" stroke-width="6" stroke-linecap="round" fill="none" stroke-linejoin="round"/>
                <g opacity="0.12" transform="translate(-6,-6)">
                  <path d="M30 70 Q30 30 70 24 Q100 18 130 24 Q170 30 170 70 Q170 110 160 126 Q150 142 140 140 Q130 138 120 146 Q110 154 100 146 Q90 138 80 142 Q70 146 60 142 Q50 138 40 126 Q30 110 30 70 Z" fill="#ffffff" />
                </g>
              </g>
            </svg>
          </div>
          <div class="msg">åš‡ä¸€è·³äº†å—ï¼ŸğŸ‘»</div>
          <button class="btn" id="closeBtn">é—œé–‰</button>
        </div>

        <script>
          try {
            const ctx = new (window.AudioContext || window.webkitAudioContext)();
            const g = ctx.createGain();
            const o1 = ctx.createOscillator(); o1.type='sine'; o1.frequency.value=240;
            const o2 = ctx.createOscillator(); o2.type='sawtooth'; o2.frequency.value=360;
            o1.connect(g); o2.connect(g); g.connect(ctx.destination);
            g.gain.value = 0.0001;
            g.gain.linearRampToValueAtTime(0.16, ctx.currentTime + 0.01);
            o1.start(); o2.start();
            g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 1.1);
            o1.frequency.exponentialRampToValueAtTime(120, ctx.currentTime + 1.1);
            o2.frequency.exponentialRampToValueAtTime(160, ctx.currentTime + 1.1);
            setTimeout(()=>{ o1.stop(); o2.stop(); ctx.close(); }, 1300);
          } catch(e){}
          document.getElementById('closeBtn').addEventListener('click', ()=>window.close());
        </script>
      </body>
      </html>`;
    }

    // ç•¶ç¦®ç‰©è¢«é»æ“Š
    let opened = false;
    function onOpenTriggered(e) {
      if (opened) return;
      opened = true;

      // å†æ¬¡å¼·èª¿ï¼šç¦®ç‰©ç›’ç¶­æŒè“‹è‘—ï¼ˆä¸å¥—ç”¨ open classï¼‰
      spawnConfetti();
      playPopAudio();

      // ç‚ºé¿å…ç€è¦½å™¨é˜»æ“‹å½ˆçª—ï¼Œå¿…é ˆåŒæ­¥åœ¨ä½¿ç”¨è€…äº’å‹•ï¼ˆclick/keydownï¼‰è™•ç† window.open
      let win = null;
      try {
        win = window.open('', '_blank', 'noopener,noreferrer');
      } catch (err) {
        win = null;
      }

      if (win) {
        // ç›´æ¥æŠŠé¬¼è‡‰å…§å®¹å¯«å…¥æ–°è¦–çª—ï¼ˆåŒæ­¥ï¼‰ï¼Œé€™æ¨£å¤§å¤šæ•¸ç€è¦½å™¨ä¸æœƒé˜»æ“‹
        try {
          win.document.open();
          win.document.write(ghostHtml());
          win.document.close();
          try { win.focus(); } catch(e){}
        } catch (err) {
          // è‹¥å¯«å…¥å¤±æ•—ï¼ˆæ¥µå°‘è¦‹ï¼‰ï¼Œé¡¯ç¤ºå‚™æ´ overlay
          showOverlayFallback();
        }
      } else {
        // è¢«é˜»æ“‹ -> é¡¯ç¤º overlay å‚™æ´
        showOverlayFallback();
      }

      // å…è¨±çŸ­æ™‚é–“å¾Œå¯å†æ¬¡è§¸ç™¼
      setTimeout(()=>{ opened = false; }, 1200);
    }

    // overlay å‚™æ´çš„é¬¼è‡‰ (èˆ‡æ–°è¦–çª—å…§å®¹ç›¸åŒçš„ç°¡åŒ–ç‰ˆ)
    const overlay = document.getElementById('overlay');
    const modalGhost = document.getElementById('ghostContainer');
    const closeModal = document.getElementById('closeModal');
    function showOverlayFallback(){
      // æ’å…¥ä¸€å€‹ SVG é¬¼è‡‰åˆ° modal
      modalGhost.innerHTML = `
        <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="é¬¼è‡‰" style="width:100%;height:100%">
          <defs><radialGradient id="g2" cx="40%" cy="30%"><stop offset="0%" stop-color="#ffffff"/><stop offset="100%" stop-color="#e8f7ff"/></radialGradient></defs>
          <g>
            <path d="M30 70 Q30 30 70 24 Q100 18 130 24 Q170 30 170 70 Q170 110 160 126 Q150 142 140 140 Q130 138 120 146 Q110 154 100 146 Q90 138 80 142 Q70 146 60 142 Q50 138 40 126 Q30 110 30 70 Z" fill="url(#g2)" stroke="#ffffff33" stroke-width="1.2" />
            <ellipse cx="80" cy="82" rx="8" ry="12" fill="#0a0a0a" />
            <ellipse cx="120" cy="82" rx="8" ry="12" fill="#0a0a0a" />
            <path d="M78 118 Q100 136 122 118" stroke="#0a0a0a" stroke-width="6" stroke-linecap="round" fill="none" stroke-linejoin="round"/>
          </g>
        </svg>
      `;
      overlay.classList.add('show');
      // éŸ³æ•ˆï¼ˆå†æ’­æ”¾ä¸€æ¬¡ï¼‰
      try {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const g = ctx.createGain();
        const o1 = ctx.createOscillator(); o1.type='sine'; o1.frequency.value=240;
        const o2 = ctx.createOscillator(); o2.type='sawtooth'; o2.frequency.value=360;
        o1.connect(g); o2.connect(g); g.connect(ctx.destination);
        g.gain.value = 0.0001;
        g.gain.linearRampToValueAtTime(0.16, ctx.currentTime + 0.01);
        o1.start(); o2.start();
        g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 1.1);
        o1.frequency.exponentialRampToValueAtTime(120, ctx.currentTime + 1.1);
        o2.frequency.exponentialRampToValueAtTime(160, ctx.currentTime + 1.1);
        setTimeout(()=>{ o1.stop(); o2.stop(); ctx.close(); }, 1300);
      } catch(e){}
    }

    closeModal.addEventListener('click', ()=> overlay.classList.remove('show'));

    // é»æ“Š / éµç›¤äº‹ä»¶ï¼ˆåŒæ¨£æœƒåœ¨ä½¿ç”¨è€…äº’å‹•æµç¨‹ä¸­ç«‹å³é–‹æ–°è¦–çª—ï¼‰
    gift.addEventListener('click', onOpenTriggered);
    lid.addEventListener('click', onOpenTriggered);
    scene.addEventListener('keydown', (e) => {
      if (e.code === 'Space' || e.code === 'Enter') {
        e.preventDefault();
        onOpenTriggered();
      }
    });

    gift.addEventListener('keyup', (e) => {
      if (e.code === 'Space' || e.code === 'Enter') onOpenTriggered();
    });

    // å°æç¤ºå‹•ç•«ï¼šè¼‰å…¥æ™‚ç¨å¾®æŠ–å‹•ï¼ˆç´”è¦–è¦ºï¼‰
    setTimeout(()=> {
      scene.animate([{ transform: 'translateY(0)' }, { transform: 'translateY(-6px)' }, { transform: 'translateY(0)' }], { duration: 900, iterations: 1 });
    }, 300);
  </script>
</body>
</html>
