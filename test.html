<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>點擊禮物盒 - 跳出鬼臉</title>
  <style>
    :root{
      --bg:#0b0720;
      --box:#ff4d67;
      --ribbon:#fff2f3;
      --shadow: rgba(0,0,0,0.45);
    }
    html,body{height:100%;margin:0;font-family:system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans TC";background:
      radial-gradient(1200px 600px at 10% 10%, rgba(255,255,255,0.02), transparent),
      linear-gradient(180deg,#050312 0%, #0b0720 60%); color:#fff;display:flex;align-items:center;justify-content:center;}
    .wrap{display:flex;flex-direction:column;align-items:center;gap:18px}
    .hint{font-size:18px;opacity:0.95}
    .box-scene{width:220px;height:220px;position:relative;display:flex;align-items:flex-end;justify-content:center;cursor:pointer;user-select:none}
    /* 禮物盒本體 */
    .gift{
      width:160px;height:120px;background:linear-gradient(180deg,var(--box), #b32a45);
      border-radius:8px;position:relative;box-shadow:0 14px 30px var(--shadow), inset 0 -6px 12px rgba(0,0,0,0.15);
      transform-origin:center bottom;transition:transform 420ms cubic-bezier(.2,.9,.2,1);
    }
    /* 蓋子 */
    .lid{
      position:absolute;top:-24px;width:180px;height:36px;background:linear-gradient(180deg,#ff6d80,#b02a40);
      border-radius:8px;left:50%;transform:translateX(-50%);box-shadow:0 8px 18px rgba(0,0,0,0.4);
      transform-origin:center bottom;transition:transform 520ms cubic-bezier(.15,.9,.2,1);
    }
    /* 蝴蝶結 (簡單造型) */
    .bow{
      position:absolute;top:-6px;left:50%;transform:translateX(-50%);width:84px;height:48px;
      display:flex;align-items:center;justify-content:center;gap:6px;
    }
    .bow .knot{width:18px;height:18px;background:var(--ribbon);border-radius:4px;box-shadow:inset 0 -3px rgba(0,0,0,0.08)}
    .bow .loop{width:30px;height:18px;background:linear-gradient(180deg,#fff,#ffd6db);border-radius:8px;transform:rotate(10deg)}
    .bow .loop.right{transform:rotate(-10deg)}
    /* 綁帶 */
    .ribbon-vert{position:absolute;left:50%;top:0;bottom:0;width:18px;background:linear-gradient(180deg,#ffdfe6,#ffb6c7);transform:translateX(-50%);border-radius:6px}
    .ribbon-horiz{position:absolute;top:36px;left:6px;right:6px;height:18px;background:linear-gradient(90deg,#ffdfe6,#ffb6c7);border-radius:6px}
    /* 點擊時開蓋 */
    .open .lid{transform: translateX(-50%) translateY(-40px) rotate(-12deg) scale(1.03);}
    .open .gift{transform: translateY(6px) rotate(-1.5deg) scaleY(0.98);}
    /* 小火花／confetti */
    .confetti { position:absolute; inset:0; pointer-events:none; overflow:visible; }
    .confetti .p { position:absolute; width:8px; height:12px; border-radius:2px; transform-origin:center; opacity:0; animation:burst 900ms forwards ease-out; }
    @keyframes burst {
      0% { opacity:1; transform:translateY(0) scale(1) rotate(0deg); }
      100% { opacity:0; transform:translateY(-160px) translateX(var(--tx)) rotate(var(--rot)) scale(0.6); }
    }
    /* 模態覆蓋 (備援) */
    .overlay { position:fixed; inset:0; display:flex;align-items:center;justify-content:center;background:rgba(3,2,10,0.65);backdrop-filter:blur(2px); visibility:hidden; opacity:0; transition:opacity .18s; z-index:40 }
    .overlay.show { visibility:visible; opacity:1; }
    .modal { width:min(520px,92vw); max-width:760px; background:linear-gradient(180deg,#0b0716,#120922); border-radius:12px; padding:28px; box-shadow:0 20px 60px rgba(3,2,10,0.7); color:#fff; display:flex;flex-direction:column;align-items:center; gap:14px; }
    .close-btn{background:#ff6b6b;color:#fff;border:0;padding:8px 12px;border-radius:8px;cursor:pointer}
    /* 小提示文字 */
    .small{font-size:13px;opacity:0.9}
    /* 響應式調整 */
    @media (max-width:420px){
      .gift{width:140px;height:100px}
      .lid{width:160px;height:32px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="hint">點擊禮物盒看看有什麼驚喜！</div>

    <div id="scene" class="box-scene" aria-hidden="false" title="點擊我">
      <div class="confetti" id="confetti"></div>

      <div id="lid" class="lid" aria-hidden="true">
        <div class="bow" aria-hidden="true">
          <div class="loop"></div>
          <div class="knot"></div>
          <div class="loop right"></div>
        </div>
      </div>

      <div id="gift" class="gift" role="button" tabindex="0" aria-label="禮物盒"></div>

      <div class="ribbon-vert" aria-hidden="true"></div>
      <div class="ribbon-horiz" aria-hidden="true"></div>
    </div>

    <div class="small">（或按鍵盤空白鍵 / Enter）</div>
  </div>

  <!-- 模態備援 -->
  <div id="overlay" class="overlay" role="dialog" aria-modal="true">
    <div class="modal" id="modalContent">
      <div id="ghostContainer" style="width:320px;height:320px;display:flex;align-items:center;justify-content:center"></div>
      <button class="close-btn" id="closeModal">關閉</button>
    </div>
  </div>

  <script>
    const scene = document.getElementById('scene');
    const gift = document.getElementById('gift');
    const lid = document.getElementById('lid');
    const confettiRoot = document.getElementById('confetti');

    // 產生 confetti 元素
    function spawnConfetti(xOrigin = 80, count = 18) {
      const colors = ['#ffd166','#ef476f','#06d6a0','#118ab2','#f72585'];
      for (let i = 0; i < count; i++) {
        const p = document.createElement('div');
        p.className = 'p';
        p.style.background = colors[Math.floor(Math.random()*colors.length)];
        const tx = (Math.random()*260 - 130) + 'px';
        p.style.setProperty('--tx', tx);
        p.style.setProperty('--rot', (Math.random()*720 - 360) + 'deg');
        p.style.left = (80 + (Math.random()*40-20)) + 'px';
        p.style.top = (60 + Math.random()*30) + 'px';
        p.style.transform = `translateZ(0)`;
        confettiRoot.appendChild(p);
        // 移除
        setTimeout(()=> p.remove(), 1200 + Math.random()*600);
      }
    }

    // WebAudio 簡單打擊音（用於禮物打開）
    function playPopAudio() {
      try {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const o = ctx.createOscillator();
        const g = ctx.createGain();
        o.type = 'triangle';
        o.frequency.setValueAtTime(420, ctx.currentTime);
        o.connect(g);
        g.connect(ctx.destination);
        g.gain.setValueAtTime(0, ctx.currentTime);
        g.gain.linearRampToValueAtTime(0.14, ctx.currentTime + 0.01);
        o.start();
        g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.45);
        o.frequency.exponentialRampToValueAtTime(160, ctx.currentTime + 0.45);
        setTimeout(()=>{ o.stop(); ctx.close(); }, 600);
      } catch(e){ /* ignore */ }
    }

    // 生成鬼臉頁面內容字串*
