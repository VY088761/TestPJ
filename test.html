<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>禮物盒（請點我）- 鬼臉 GIF 範例</title>
  <style>
    :root{
      --bg: #0b0720;
      --box:#e54b6b;
      --box-dark:#b5384f;
      --ribbon:#fff7ea;
      --accent:#ffd166;
      --glass: rgba(255,255,255,0.06);
    }
    html,body{height:100%;margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans TC",Arial;background:
      radial-gradient(800px 400px at 10% 10%, rgba(255,255,255,0.02), transparent),
      linear-gradient(180deg,#050312 0%, var(--bg) 60%);
      color:#fff;display:flex;align-items:center;justify-content:center;}

    .stage{display:flex;flex-direction:column;align-items:center;gap:18px;padding:28px}

    /* CTA 文字（大、閃爍）*/
    .cta {
      font-size:36px;
      font-weight:900;
      color:var(--accent);
      letter-spacing:2px;
      text-shadow:0 6px 18px rgba(0,0,0,0.6),0 0 10px rgba(255,209,102,0.6);
      animation: glow 1.2s ease-in-out infinite, flicker 2s infinite;
      user-select:none;
    }
    @keyframes glow {
      0%{ transform: translateY(0) scale(1); opacity:0.95; }
      50%{ transform: translateY(-6px) scale(1.03); opacity:1; }
      100%{ transform: translateY(0) scale(1); opacity:0.95; }
    }
    @keyframes flicker {
      0%{ filter:brightness(1); }
      15%{ filter:brightness(1.25); }
      30%{ filter:brightness(0.9); }
      50%{ filter:brightness(1.1); }
      100%{ filter:brightness(1); }
    }

    /* 禮物盒容器 */
    .box-wrap{ width:220px; height:220px; display:flex; align-items:center; justify-content:center; position:relative; }
    /* 正方形禮物盒（始終蓋著） */
    .gift {
      width:160px; height:160px; background: linear-gradient(180deg, var(--box), var(--box-dark));
      border-radius:8px; position:relative; box-shadow: 0 18px 40px rgba(0,0,0,0.6), inset 0 -6px 14px rgba(0,0,0,0.12);
      display:flex; align-items:center; justify-content:center; cursor:pointer; outline: none; border: none;
      transition: transform 160ms ease, box-shadow 160ms ease;
      user-select:none;
    }
    .gift:active { transform: translateY(3px) scale(0.995); }
    .gift:focus { box-shadow: 0 20px 46px rgba(0,0,0,0.7), 0 0 0 6px rgba(255,209,102,0.06); }

    /* 綁帶（垂直與水平）*/
    .ribbon-vert {
      position:absolute; width:20px; height:120px; background: linear-gradient(180deg,#fff6e9,#ffd6d8);
      left:50%; transform:translateX(-50%); border-radius:6px; z-index:2;
      box-shadow: inset 0 -4px rgba(0,0,0,0.06);
    }
    .ribbon-horiz {
      position:absolute; height:20px; left:24px; right:24px; top:50%; transform:translateY(-50%);
      background: linear-gradient(90deg,#fff6e9,#ffd6d8); border-radius:6px; z-index:2;
      box-shadow: inset -4px 0 rgba(0,0,0,0.06);
    }

    /* 蝴蝶結（簡單造型）*/
    .bow {
      position:absolute; top:18px; left:50%; transform:translateX(-50%); z-index:3;
      display:flex; align-items:center; gap:6px;
    }
    .bow .loop {
      width:36px; height:22px; background: linear-gradient(180deg,#fff,#ffd6db);
      border-radius:12px; transform-origin:center; box-shadow: inset 0 -4px rgba(0,0,0,0.06);
    }
    .bow .knot { width:18px; height:18px; background:var(--ribbon); border-radius:4px; box-shadow: inset 0 -3px rgba(0,0,0,0.06); }

    /* 小提示文字 */
    .hint { font-size:14px; opacity:0.9; color:#dcd7e5; }

    /* confetti */
    .confetti { position:absolute; inset:0; pointer-events:none; overflow:visible; z-index:4; }
    .confetti .piece {
      position:absolute; width:8px; height:12px; border-radius:3px; opacity:0; transform-origin:center;
      animation: confettiAnim 900ms forwards ease-out;
    }
    @keyframes confettiAnim {
      0% { opacity:1; transform: translateY(0) rotate(0) scale(1); }
      100% { opacity:0; transform: translateY(-160px) translateX(var(--tx)) rotate(var(--rot)) scale(0.6); }
    }

    /* overlay modal */
    .overlay {
      position:fixed; inset:0; display:flex; align-items:center; justify-content:center;
      background: rgba(3,2,10,0.7); backdrop-filter: blur(4px); visibility:hidden; opacity:0;
      transition: opacity 180ms ease; z-index:50;
    }
    .overlay.show { visibility:visible; opacity:1; }
    .modal {
      width:min(760px,92vw); max-width:760px; background: linear-gradient(180deg,#0b0716,#120922);
      border-radius:12px; padding:16px; box-shadow: 0 30px 80px rgba(0,0,0,0.7); display:flex; flex-direction:column;
      align-items:center; gap:12px; color:#fff;
    }
    .modal .gif {
      width:88vw; max-width:560px; height:auto; border-radius:8px; display:block;
      box-shadow: 0 12px 40px rgba(0,0,0,0.6);
    }
    .close-btn {
      background:var(--accent); color:#2b2216; border:0; padding:10px 14px; border-radius:8px; cursor:pointer; font-weight:700;
    }

    /* small screens */
    @media (max-width:420px) {
      .cta { font-size:26px; }
      .box-wrap{ width:180px; height:180px; }
      .gift{ width:140px; height:140px; }
      .bow .loop{ width:28px; height:18px; }
    }
  </style>
</head>
<body>
  <main class="stage" role="main">
    <div class="cta" aria-hidden="true">請點我</div>

    <div class="box-wrap">
      <div id="confetti" class="confetti" aria-hidden="true"></div>

      <button id="gift" class="gift" aria-label="禮物盒，點擊觀看驚喜" title="點我看驚喜">
        <!-- optional label inside box -->
      </button>

      <div class="ribbon-vert" aria-hidden="true"></div>
      <div class="ribbon-horiz" aria-hidden="true"></div>

      <div class="bow" aria-hidden="true">
        <div class="loop" style="transform:rotate(10deg)"></div>
        <div class="knot"></div>
        <div class="loop" style="transform:rotate(-10deg)"></div>
      </div>
    </div>

    <div class="hint">（或按 空白鍵 / Enter）</div>
  </main>

  <!-- modal overlay (只用 modal，避免被瀏覽器彈窗阻擋) -->
  <div id="overlay" class="overlay" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" role="document">
      <!-- 使用者要求顯示 giphy.gif -->
      <!-- 把 giphy.gif 放在同目錄，或改成完整 URL -->
      <img id="ghostGif" class="gif" src="giphy.gif" alt="鬼臉 GIF (giphy.gif)" />
      <button id="close" class="close-btn" aria-label="關閉">關閉</button>
    </div>
  </div>

  <script>
    // 元件
    const gift = document.getElementById('gift');
    const overlay = document.getElementById('overlay');
    const closeBtn = document.getElementById('close');
    const ghostGif = document.getElementById('ghostGif');
    const confettiRoot = document.getElementById('confetti');

    // 產生簡單 confetti（視覺加強）
    function spawnConfetti(count = 18) {
      const colors = ['#ffd166','#ef476f','#06d6a0','#118ab2','#f72585','#ffffff'];
      for (let i = 0; i < count; i++) {
        const p = document.createElement('div');
        p.className = 'piece';
        p.style.background = colors[Math.floor(Math.random()*colors.length)];
        const tx = (Math.random()*260 - 130) + 'px';
        const rot = (Math.random()*720 - 360) + 'deg';
        p.style.setProperty('--tx', tx);
        p.style.setProperty('--rot', rot);
        // spawn around center of gift
        const left = 80 + (Math.random()*40 - 20);
        const top = 80 + (Math.random()*40 - 20);
        p.style.left = left + 'px';
        p.style.top = top + 'px';
        p.style.transform = 'translateZ(0)';
        confettiRoot.appendChild(p);
        // remove after animation
        setTimeout(()=> p.remove(), 1200 + Math.random()*600);
      }
    }

    // 簡單按鍵音（非必要，若瀏覽器允許會播放）
    function playPop() {
      try {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const o = ctx.createOscillator();
        const g = ctx.createGain();
        o.type = 'triangle';
        o.frequency.setValueAtTime(520, ctx.currentTime);
        o.connect(g);
        g.connect(ctx.destination);
        g.gain.setValueAtTime(0, ctx.currentTime);
        g.gain.linearRampToValueAtTime(0.12, ctx.currentTime + 0.01);
        o.start();
        g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.5);
        o.frequency.exponentialRampToValueAtTime(220, ctx.currentTime + 0.5);
        setTimeout(()=> { o.stop(); ctx.close(); }, 700);
      } catch(e) { /* ignore if blocked */ }
    }

    // 打開 modal（顯示 giphy.gif）
    function showGhost() {
      // 先確保 GIF 已設定好，如果找不到，顯示替代內容
      // 顯示 overlay
      overlay.classList.add('show');
      overlay.setAttribute('aria-hidden','false');
      // 觸發音效與 confetti
      playPop();
      spawnConfetti(24);
      // 從頭播 GIF（如果想重新播放，替換 src trick）
      const src = ghostGif.getAttribute('src') || '';
      if (src) {
        // force reload to restart animation
        const t = Date.now();
        ghostGif.src = src.split('?')[0] + '?_=' + t;
      }
      // focus close button for keyboard users
      setTimeout(()=> closeBtn.focus(), 200);
    }

    function hideGhost() {
      overlay.classList.remove('show');
      overlay.setAttribute('aria-hidden','true');
      // stop gif by removing src (optional) - keep src to allow replay next time
      // ghostGif.src = ghostGif.getAttribute('src'); // keep as-is
      gift.focus();
    }

    // Click / keyboard handlers
    function onActivate(e) {
      // Only respond to primary mouse button or keyboard Enter/Space
      if (e instanceof KeyboardEvent) {
        if (e.code !== 'Space' && e.code !== 'Enter') return;
        e.preventDefault();
      } else if (e instanceof MouseEvent) {
        if (e.button !== 0) return;
      }
      showGhost();
    }

    gift.addEventListener('click', onActivate);
    gift.addEventListener('keydown', (e) => {
      if (e.code === 'Enter' || e.code === 'Space') {
        e.preventDefault();
        onActivate(e);
      }
    });

    // close handlers
    closeBtn.addEventListener('click', hideGhost);
    overlay.addEventListener('click', (e) => {
      // only close when clicking outside modal content
      if (e.target === overlay) hideGhost();
    });
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && overlay.classList.contains('show')) hideGhost();
    });

    // 初始焦點與無障礙
    gift.setAttribute('tabindex','0');
    gift.addEventListener('keyup', (e) => {
      if (e.code === 'Space' || e.code === 'Enter') {
        // already handled on keydown, but keep fallback
        onActivate(e);
      }
    });

    // 小動畫：讓禮物緩微浮動吸引點擊
    setTimeout(()=> {
      gift.animate([
        { transform: 'translateY(0)' },
        { transform: 'translateY(-8px)' },
        { transform: 'translateY(0)' }
      ], { duration: 1400, iterations: Infinity, easing: 'ease-in-out' });
    }, 300);
  </script>
</body>
</html>
